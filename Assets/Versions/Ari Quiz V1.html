<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ari Quiz (Standalone HTML)</title>
<style>
  :root{--menu-blue:#4472C4;--game-bg:#071a2b;--accent:#00c97a}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Roboto,Arial;background:var(--menu-blue)}

  /* Screens */
  #menu, #game, #formulasOverlay { width:100%; height:100vh; }
  #game, #formulasOverlay{ display:none; }

  /* MENU layout */
  #menu{display:flex;justify-content:space-between;align-items:center;padding:36px}
  #menuLeft{display:flex;flex-direction:column;gap:20px}
  #logo{width:460px}
  .menu-btn{background:none;border:0;padding:0;cursor:pointer}
  .menu-btn img{width:320px;display:block}
  #summaryBtn{width:280px;cursor:pointer}
  #menuRight img{width:620px;max-width:40vw;height:auto}

  /* FORMULAS overlay */
  #formulasOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);z-index:120}
  #formulasOverlay img{max-width:92%;height:auto}

  /* GAME screen */
  #game{background:var(--game-bg);color:#fff;padding:20px;overflow:auto}
  .question-card{max-width:1100px;margin:20px auto;border-radius:12px;background:#fff;color:#000;padding:18px}
  .question-text{font-size:20px;text-align:center}
  .layout{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:320px 1fr;gap:18px;align-items:start}

  /* Ari area */
  .ari-wrap{position:relative;height:420px}
  #ari{position:absolute;left:0;bottom:0;width:320px;height:auto}
  #ariHud{position:absolute;left:0;bottom:-74px;width:320px;background:#000;padding:12px;border-radius:8px;color:#fff}
  #ariHud .stat{font-weight:700}

  /* Options */
  .options-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .opt{background:var(--accent);color:#002518;padding:16px;border-radius:10px;border:0;font-weight:800;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.5)}
  .opt.disabled{opacity:0.45;pointer-events:none}

  /* Result overlay (cover) */
  #resultOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:100}
  #resultOverlay img{width:24%;animation:drop 0.9s cubic-bezier(.2,.9,.3,1) forwards}
  @keyframes drop{0%{transform:translateY(-350px) scale(0.6);opacity:0}70%{transform:translateY(20px) scale(1.05);opacity:1}100%{transform:translateY(0) scale(1);opacity:1}}

  /* Just one modal */
  #justOneModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#000;z-index:130}
  #justOneModal img{width:48%}

  /* Dialog box */
  #dialogBox{display:none;background:rgba(0,0,0,0.6);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);max-width:520px;color:#fff}
  #dialogBox button{margin-top:8px;padding:10px 14px;border-radius:8px;background:#004aad;border:0;color:#fff;font-weight:800;cursor:pointer}

  @media(max-width:960px){
    #menu{flex-direction:column;align-items:flex-start}
    #menuRight img{width:320px}
    .layout{grid-template-columns:1fr}
    #ari{width:260px}
    #ariHud{position:relative;bottom:auto;margin-top:8px}
  }
</style>
</head>
<body>

<!-- MENU -->
<div id="menu">
  <div id="menuLeft">
    <img id="logo" src="Assets/Images/Logo.png" alt="Logo">
    <button class="menu-btn" id="playBtn"><img src="Assets/Images/Buttons/PLAY NOW.png" alt="Play Now"></button>
    <img id="summaryBtn" src="Assets/Images/Buttons/Summary.png" alt="Summary">
  </div>
  <div id="menuRight"><img src="Assets/Images/Ari_Static_2.png" alt="Ari Menu"></div>
</div>

<div id="formulasOverlay" onclick="this.style.display='none'"><img src="Assets/Images/Formulas.png" alt="Formulas"></div>

<!-- GAME -->
<div id="game">
  <div class="question-card"><div id="questionText" class="question-text">Aqu√≠ aparecer√° la pregunta</div></div>

  <div class="layout">
    <div class="ari-wrap">
      <img id="ari" src="Assets/Images/Ari_Static_0.png" alt="Ari">
      <div id="ariHud">
        <div class="stat">LIVES: <span id="livesSpan">‚ù§‚ù§‚ù§‚ù§‚ù§</span></div>
        <div class="stat" style="margin-top:8px">SCORE: <span id="scoreSpan">0</span></div>
      </div>
    </div>

    <div>
      <div id="optionsGrid" class="options-grid"></div>
      <div id="dialogWrap" style="margin-top:16px;display:flex;justify-content:flex-start;align-items:flex-start;gap:12px"><div id="dialogBox"></div></div>
    </div>
  </div>
</div>

<div id="resultOverlay"></div>
<div id="justOneModal"><img src="Assets/Images/JustOneMore.gif" alt="Just One More"></div>

<!-- audio -->
<audio id="bgAudio" loop></audio>
<audio id="sfxCorrect"></audio>
<audio id="sfxIncorrect"></audio>
<audio id="sfxJustOne"></audio>

<script>
// --- Assets config ---
const MUSIC = {
  menu: 'Assets/Music/Skullgirls OST #03 - Pedestrians Crossing.mp3',
  q1_10: 'Assets/Music/Courtroom Lobby Beginning Overture.mp3',
  correct1_10: 'Assets/Music/Phoenix Wright Ace Attorney OST - Logic and Trick.mp3',
  wrong1_10: "Assets/Music/Phoenix Wright Ace Attorney OST - Detention Center Jailers' Elegy.mp3"
};
const SFX = {
  correct: 'Assets/Sound Effects/Correct.mp3',
  incorrect: 'Assets/Sound Effects/Incorrect.mp3',
  justOne: 'Assets/Sound Effects/A NEW CHALLENGER HAS APPEARED!.mp3'
};

// --- placeholders: 50 questions and Ari dialogs ---
const QUESTIONS = [];
const ARI_CORRECT = [];
const ARI_INCORRECT = [];
for(let i=1;i<=50;i++){
  QUESTIONS.push({q:`Preg ${i}`, a:["ResCorr","ResInc","ResInc","ResInc"], correct:0});
  ARI_CORRECT.push(`Ari's Text Corr ${i}`);
  ARI_INCORRECT.push(`Ari's Text Inc ${i}`);
}

// --- state ---
let current = 0;
let lives = 5;
let score = 0;
let justOneShown = false; // show just one only once
let answered = false; // whether current question has been answered and waiting next

// --- DOM refs ---
const menu = document.getElementById('menu');
const playBtn = document.getElementById('playBtn');
const summaryBtn = document.getElementById('summaryBtn');
const formulasOverlay = document.getElementById('formulasOverlay');
const game = document.getElementById('game');
const questionText = document.getElementById('questionText');
const optionsGrid = document.getElementById('optionsGrid');
const ari = document.getElementById('ari');
const ariHudLives = document.getElementById('livesSpan');
const ariHudScore = document.getElementById('scoreSpan');
const dialogBox = document.getElementById('dialogBox');
const resultOverlay = document.getElementById('resultOverlay');
const justOneModal = document.getElementById('justOneModal');

const bgAudio = document.getElementById('bgAudio');
const sfxCorrect = document.getElementById('sfxCorrect');
const sfxIncorrect = document.getElementById('sfxIncorrect');
const sfxJustOne = document.getElementById('sfxJustOne');

// --- helpers: audio ---
function setBg(path){ if(!path) return; try{ bgAudio.pause(); bgAudio.src = path; bgAudio.currentTime = 0; bgAudio.play().catch(()=>{}); }catch(e){} }
function stopBg(){ try{ bgAudio.pause(); bgAudio.src=''; }catch(e){} }

function playQuestionMusic(idx){ // change immediately
  setBg(MUSIC.q1_10);
}
function playResultMusic(correct, idx){ // play result music and keep playing until Next pressed
  stopBg();
  const p = correct ? MUSIC.correct1_10 : MUSIC.wrong1_10;
  setBg(p);
}

function playSfx(name){ try{ if(name==='correct'){ sfxCorrect.src=SFX.correct; sfxCorrect.currentTime=0; sfxCorrect.play().catch(()=>{});} if(name==='incorrect'){ sfxIncorrect.src=SFX.incorrect; sfxIncorrect.currentTime=0; sfxIncorrect.play().catch(()=>{});} if(name==='justone'){ sfxJustOne.src=SFX.justOne; sfxJustOne.currentTime=0; sfxJustOne.play().catch(()=>{});} }catch(e){} }

// --- UI actions ---
playBtn.addEventListener('click', ()=>{
  menu.style.display='none';
  game.style.display='block';
  startGame();
});
summaryBtn.addEventListener('click', ()=>{ formulasOverlay.style.display='flex'; });

function renderHUD(){
  ariHudLives.textContent = 'LIVES: ' + '‚ù§'.repeat(lives) + 'üíî'.repeat(5 - lives);
  ariHudScore.textContent = score;
}

function loadQuestion(){
  answered = false;
  dialogBox.style.display = 'none';
  resultOverlay.style.display = 'none';
  // set Ari to questioning
  ari.src = 'Assets/Images/Ari_Questioning.png';

  const q = QUESTIONS[current];
  questionText.textContent = q ? q.q : '---';
  optionsGrid.innerHTML = '';
  if(!q) return;

  q.a.forEach((opt, idx)=>{
    const b = document.createElement('button');
    b.className = 'opt';
    b.textContent = opt;
    b.dataset.index = idx;
    b.addEventListener('click', ()=> onOptionClick(idx, b));
    optionsGrid.appendChild(b);
  });

  renderHUD();
  playQuestionMusic(current);
}

function onOptionClick(idx, btn){
  if(answered) return; // waiting next
  answered = true;
  // disable other options visually
  Array.from(optionsGrid.children).forEach(c=>c.classList.add('disabled'));

  const q = QUESTIONS[current];
  const correct = (idx === q.correct);

  // show falling overlay (circle or X) and play full SFX then reveal Ari
  resultOverlay.style.display = 'flex';
  resultOverlay.style.background = correct ? 'rgba(0,255,0,0.35)' : 'rgba(255,0,0,0.35)';
  resultOverlay.innerHTML = `<img src="Assets/Images/${correct ? 'correct_circle.png' : 'incorrect_x.png'}" alt="result">`;

  // play sfx and result music
  if (correct) { playSfx('correct'); playResultMusic(true, current); score = score + 1; } else { playSfx('incorrect'); playResultMusic(false, current); lives = Math.max(0, lives - 1); }

  // if reached 1 life and not shown before -> show JustOne modal once
  if(lives===1 && !justOneShown){ justOneShown=true; playSfx('justone'); justOneModal.style.display='flex'; setTimeout(()=>{ justOneModal.style.display='none'; },2200); }

  // after the falling animation and sounds, hide overlay and show Ari dialog & Next
  // we'll wait approx 1200ms to give SFX moment to play primary hit
  setTimeout(()=>{
    resultOverlay.style.display = 'none';
    // show Ari reaction image and dialog box
    if(correct){ ari.src = 'Assets/Images/Ari_Show_1.png'; dialogBox.textContent = ARI_CORRECT[current] || 'Buen trabajo.'; }
    else { ari.src = 'Assets/Images/Ari_CrossedHands_1.png'; dialogBox.textContent = ARI_INCORRECT[current] || 'Ja.'; }
    dialogBox.style.display = 'block';
    // show Next button inside dialog
    const nextBtn = document.createElement('button'); nextBtn.id='nextBtn'; nextBtn.textContent='¬ª Next Question';
    nextBtn.addEventListener('click', onNext);
    // remove old next if any
    const old = document.getElementById('nextBtn'); if(old) old.remove();
    dialogBox.appendChild(nextBtn);
    renderHUD();
  }, 1200);
}

function onNext(){
  // advance question and switch music back to question music
  current++;
  if(current >= QUESTIONS.length){ endGame(); return; }
  loadQuestion();
}

function startGame(){ current=0; lives=5; score=0; justOneShown=false; loadQuestion(); }

function endGame(){ stopBg(); questionText.textContent='FINISHED'; optionsGrid.innerHTML=''; dialogBox.style.display='block'; dialogBox.textContent = `Puntuaci√≥n final: ${score} / ${QUESTIONS.length}`; if(lives===5) ari.src='Assets/Images/Perfect.gif'; else ari.src='Assets/Images/Score.gif'; }

// Play menu music at load
window.addEventListener('load', ()=>{ try{ bgAudio.src = MUSIC.menu; bgAudio.play().catch(()=>{}); }catch(e){} });

</script>
</body>
</html>
